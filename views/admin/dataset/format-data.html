{% set currentView = ['dataset', 'format-data'] %}

{% extends "../../layout/admin.html" %}

{% block headSuffix %}
	<title>Admin - Arrays</title>
{% endblock %}

{% block content %}
	<header class="admin-header">
		<h1 class="admin-title">{{doc.title}} - Format Data</h1>
	</header>

	<div class="reminderMsg"></div>



	{% if flash | length %}
	<div class="alert alert-success" role="alert">{{ flash }}</div>
	{% elif error | length %}
	<div class="alert alert-danger" role="alert">{{ error }}</div>
	{% endif %}

	<div class="dataset">
		{% include "../../partials/admin/dataset-breadcrumb.html" %}

		<br />

		<form class="format-data" method="post">

			<input type="hidden" id="doc_title" value="{{ doc.title }}" />
			<input type="hidden" id="doc_id" value="{{ doc._id }}"/>

			<div class="form-group row">
				<label class="col-xs-4" for="fn_new_rowPrimaryKeyFromRowObject">Primary Key: </label>
				<div class="col-xs-8">
					<select id="fn_new_rowPrimaryKeyFromRowObject" name="fn_new_rowPrimaryKeyFromRowObject" class="form-control">
						{% for colName in colNames %}
						<option value="{{ colName }}" {{ 'selected' if colName == doc.fn_new_rowPrimaryKeyFromRowObject }}>{{ colName }}</option>
						{% endfor %}
					</select>
				</div>
			</div>

			<div class="form-group row">
				<div class="col-xs-12">
					<button type="button" class="form-control" id="fabribatedFilters">Fabricated Filters</button>
				</div>
			</div>


			<input type="hidden" id="changed" name="changed" value="false"/>

			<table id="fields" class="table">
				<thead>
				<tr>
					<th>#</th>
					<th>Exclude</th>
					<th>Column Name</th>
					<th>Type</th>
					<th>Sample</th>
				</tr>
				</thead>
				<tbody>
				{% for colName in colNames %}
				{% set finalizedColName = colName | finalizeColumnName %}
				<tr class="field" data-field-name="{{ colName }}">
					<th scope="row">{{ loop.index }}</th>
					<td><input type="checkbox" {{ 'checked=checked' if
						doc.fe_excludeFields | doesArrayContain(finalizedColName) }} disabled></td>
					<td>{{ colName }}</td>
					<td>
						{{ doc.raw_rowObjects_coercionScheme[finalizedColName] | fieldDataType_coercion_toString }}
					</td>
					<td class="word-break">{{ firstRecord[loop.index0] }}</td>
				</tr>
				{% endfor %}

				<tr class="custom-field-seperator">
					<td colspan="5">Custom Fields</td>
				</tr>
				{% if doc.customFieldsToProcess | length != 0 %}
					{% for customField in doc.customFieldsToProcess %}
					{% set finalizedColName = customField.fieldName | finalizeColumnName %}
					<tr class="custom-field" data-field-name="{{ customField.fieldName }}">
						<th scape="row">{{ colNames | length + loop.index }}</th>
						<td><input type="checkbox" {{ 'checked=checked' if
							doc.fe_excludeFields | doesArrayContain(finalizedColName) }} disabled></td>
						<td>{{ finalizedColName }}</td>
						<td>{{ customField.fieldType | capitalize }}</td>
						<td></td>
					</tr>
					{% endfor %}
				{% endif %}

				<tr class="form-group">
					<td colspan="5"><button type="button" class="form-control" id="newCustomField">Add a Custom Field</button></td>
				</tr>
				</tbody>
			</table>

			<div class="panel-footer">
				<a class="btn btn-default pull-left" href="source"><span class="glyphicon glyphicon-hand-left"></span> Back</a>
				<button type="submit" class="btn btn-default pull-right"><span class="glyphicon glyphicon-hand-right"></span> Import</button>
				<div class="clearfix"></div>
			</div>
		</form>

	</div>

	{% include "../../partials/admin/modal.html" %}

{% endblock %}

{% block inlineScript %}
	{{ super() }}

	<script type="text/javascript" src="/javascripts/module/admin/dataset.js"></script>
	<script type="text/javascript" src="/javascripts/vendors/chosen/chosen.jquery.js"></script>
{% endblock %}