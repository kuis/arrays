<md-content layout-padding ng-if="dataset.uid" md-no-ink>
    <form name="vm.dataForm" ng-submit="submitForm(!vm.dataForm.$invalid )">

        <h2>Actions</h2>
        <div layout="row" layout-align="space-between center">
            <a ng-click="openFieldDialog($event, '', null, true, dataset.customFieldsToProcess ? dataset.customFieldsToProcess.length : 0)">
                Add Field
            </a>
            <a ng-click="openNestedDialog()">
                Nest Fields
            </a>
            <a ng-click="openFabricatedFilterDialog()">
                Edit Filters
            </a>
            <a ng-click="openImageScrapingDialog()">
                Image Scraping
            </a>
            <a ng-click="openJoinDialog()">
                Join Dataset
            </a>
        </div>

        <md-input-container class="md-block" flex-gt-sm>
            <label>Object Title</label>
            <md-select required name="ObjectTitle"
                       ng-model="data.fe_designatedFields.objectTitle"
                       >
                <md-option ng-repeat="column in dataset.columns track by column.name" value="{{column.name}}">
                    {{column.name}}
                </md-option>
            </md-select>
        </md-input-container>

        <fieldset class="standard">
            <!-- <legend>Fields</legend> -->
            <table class="fields-container">
                <thead class="field-row-header field">
                <tr layout="row" layout-align="space-between start">
                    <th flex="10" aa-tooltip="Drag to re-order">Order</th>
                    <th flex="10" class="incl-excl-all" aa-tooltip="{{ excludeAll ? 'Exclude All' : 'Include All' }}">
                        Include<br />
                        <md-checkbox ng-model="excludeAll" ng-change="toggleExclude(!excludeAll)" md-no-ink aria-label="Include/Exclude All"></md-checkbox>
                    </th>
                    <th flex="30">Column Name</th>
                    <th flex="15">Type</th>
                    <th flex="30">Sample</th>
                    <th flex="5"></th>
                </tr>
                </thead>
                <tbody ui-sortable="fieldSortableOptions" ng-model="data.fields" class="fields">
                    <tr ng-repeat="field in data.fields" class="field"
                        ng-class="{'custom': field.custom}" flex>
                        <!-- <div class="handler"></div> -->
                        <td class="order dashboard-list-icon" aa-tooltip="Drag to re-order" flex="10">
                            <span class="glyphicon glyphicon-move"></span>
                            <span class="field-order">
                            {{
                            dataset.fe_fieldDisplayOrder.indexOf(field.name) != -1 ?
                                dataset.fe_fieldDisplayOrder.indexOf(field.name) : ''
                            }}
                            </span>
                        </td>
                        <td class="exclude" flex="10">
                            <md-checkbox name="fe_excludeFields_{{$index}}"
                                         ng-model="dataset.fe_excludeFields[field.name]"
                                         ng-true-value="false"
                                         ng-false-value="true"
                                         aria-label="Exclude {{field.name}}"
                                         ng-click="$event.stopPropagation();" ng-change="setDirty(3)"></md-checkbox>
                        </td>
                        <td class="name" flex="30">
                            {{ dataset.fe_displayTitleOverrides[field.name] ? dataset.fe_displayTitleOverrides[field.name] + ' (' + field.name + ')' : field.name }}
                        </td>
                        <!-- <div class="override">{{ dataset.fe_displayTitleOverrides[field.name] }}</div> -->
                        <td class="type" flex="15">
                            <md-select ng-if="!field.custom"
                                       name="raw_rowObjects_coercionScheme"
                                       ng-model="coercionScheme[field.name]"
                                       ng-model-options="{trackBy: '$value | typeCoercionToString'}"
                                       ng-click="$event.stopPropagation()"
                                       ng-change="changeCoercionSchemeByOperation(field.name)"
                                       aria-label="Type - {{field.name}}" placeholder="String">
                                <md-option ng-repeat="coercion in availableTypeCoercions" ng-value="{{coercion}}">
                                    {{coercion | typeCoercionToString}}
                                </md-option>
                            </md-select>
                            <b ng-if="field.customField">
                                {{ (field.customField.fieldType | capitalize) }}
                            </b>

                            <b ng-if="field.custom">Custom</b>
                        </td>
                        <td class="sample" flex="30">
                            <span ng-if="!field.custom">{{ field.sample | limitTo:35 }}</span>
                            <span ng-if="field.customField" ng-repeat="mergeField in field.customField.fieldsToMergeIntoArray" >{{mergeField}} <span
                            ng-if="!$last">,</span> </span>
                        </td>
                        <td class="dashboard-list-icon" flex="5" aa-tooltip="Edit field"
                            ng-click="openFieldDialog($event, field.name, field.sample, field.custom, field.customFieldIndex)">
                            <i class="fa fa-pencil" aria-hidden="true"></i>
                        </td>
                    </tr>
                </tbody>
            </table>
        </fieldset>


        <div layout="row" layout-align="end center" class="hidden-submit">

            <md-button class="md-dashboard confirm" type="submit" ng-disabled="vm.dataForm.$invalid">
                <span class="btn-label">Next</span>
            </md-button>
        </div>
    </form>
</md-content>

<!-- <ng-include src="'/templates/blocks/dataset.empty.html'" ng-if="!dataset.uid"></ng-include> -->
