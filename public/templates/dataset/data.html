<md-content layout-padding ng-if="dataset.uid">
    <form name="vm.dataForm" ng-submit="submitForm(!vm.dataForm.$invalid && vm.dataForm.$dirty)">
        <md-input-container class="md-block" flex-gt-sm>
            <label>Primary Key</label>
            <md-select required name="primaryKey"
                       ng-model="data.primaryKey">
                <md-option ng-repeat="columnName in dataset.colNames" value="{{columnName}}">
                    {{columnName}}
                </md-option>
            </md-select>
            <div ng-messages="vm.dataForm.fn_new_rowPrimaryKeyFromRowObject.$error">
                <div ng-message="required">This is required.</div>
            </div>
        </md-input-container>

        <fieldset class="standard">
            <legend>Original Fields</legend>
            <div class="table-container">
            <table class="table data">
                <thead>
                <tr>
                    <th>#</th>
                    <th>Exclude</th>
                    <th>Column Name</th>
                    <th>Type</th>
                    <th>Sample</th>
                </tr>
                </thead>
                <tbody>
                <tr ng-repeat="colName in dataset.colNames"
                    ng-click="openFieldDialog($event, colName, dataset.firstRecord[$index])">
                    <td>{{ finalizedColName=(colName|dotless);$index+1 }}</td>
                    <td>
                        <md-checkbox name="fe_excludeFields_{{$index}}" ng-model="dataset.fe_excludeFields[finalizedColName]"
                                     aria-label="Exclude {{colName}}" ng-click="$event.stopPropagation()"></md-checkbox>
                    </td>
                    <td>{{ colName }}</td>
                    <td class="md-select-container">
                        <md-select name="raw_rowObjects_coercionScheme"
                                   ng-model="coercionScheme[finalizedColName]"
                                   ng-model-options="{trackBy: '$value | typeCoercionToString'}"
                                   ng-click="$event.stopPropagation()"
                                   ng-change="changeCoercionSchemeByOperation(coercionScheme[finalizedColName], finalizedColName)"
                                   aria-label="Type - {{colName}}" placeholder="String">
                            <md-option ng-repeat="coercion in availableTypeCoercions" ng-value="{{coercion}}">
                                {{coercion | typeCoercionToString}}
                            </md-option>
                        </md-select>
                    </td>
                    <td>{{ dataset.firstRecord[$index] | limitTo: 200 }}{{dataset.firstRecord[$index].length > 200 ? '...' : ''}}</td>
                </tr>
                </tbody>
                </table>
            </div>
        </fieldset>

        <fieldset class="standard" ng-if="dataset.customFieldsToProcess && dataset.customFieldsToProcess.length">
            <legend>Custom Fields</legend>

            <div class="table-container">
                <table class="table data">
                    <thead>
                    <tr>
                        <th>#</th>
                        <th style="min-width: 120px;">Column Name</th>
                        <th>Type</th>
                        <th>Fields</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr ng-repeat="customField in dataset.customFieldsToProcess"
                        ng-click="openFieldDialog($event, customField.fieldName, null, $index)">
                        <td>{{$index+1}}</td>
                        <td>{{customField.fieldName}}</td>
                        <td>{{ customField.fieldType | capitalize }}</td>
                        <td><span ng-repeat="field in customField.fieldsToMergeIntoArray"><b>{{field}}</b>, </span></td>
                    </tr>
                    </tbody>
                </table>
            </div>

        </fieldset>

        <div layout="column">
            <md-button class="md-raised" ng-click="openFieldDialog($event, '', null, dataset.customFieldsToProcess ? dataset.customFieldsToProcess.length : 0)">
                Add a New Custom Field
            </md-button>
        </div>

        <div layout="column">
            <md-button class="md-raised" ng-click="openNestedDialog()">
                Click Here to Edit if Nested
            </md-button>
        </div>

        <div layout="column">
            <md-button class="md-raised" ng-click="openFabricatedFilterDialog()">
                Click Here to Edit Fabricated And Default Filter
            </md-button>
        </div>

        <div layout="column">
            <md-button class="md-raised" ng-click="openImageScrapingDialog()">
                Click Here if you need to generate a Image URL Field by Scraping
            </md-button>
        </div>


        <div layout="row" layout-align="end center" class="panel-footer">
            <md-button class="md-raised" ng-click="reset()" ng-disabled="!vm.dataForm.$dirty">
                <i class="glyphicon glyphicon-refresh"></i> Reset
            </md-button>
            <md-button class="md-raised" type="submit" ng-disabled="vm.dataForm.$invalid || !vm.dataForm.$dirty">
                <i class="glyphicon glyphicon-ok"></i> Save
            </md-button>
        </div>
    </form>
</md-content>

<ng-include src="'/templates/blocks/dataset.empty.html'" ng-if="!dataset.uid"></ng-include>